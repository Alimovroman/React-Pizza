{"ast":null,"code":"import _objectSpread from\"C:/Users/Ramon/Documents/Stydieng_the_React/React-Pizza/react-pizza/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"C:/Users/Ramon/Documents/Stydieng_the_React/React-Pizza/react-pizza/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"C:/Users/Ramon/Documents/Stydieng_the_React/React-Pizza/react-pizza/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Ramon/Documents/Stydieng_the_React/React-Pizza/react-pizza/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Ramon/Documents/Stydieng_the_React/React-Pizza/react-pizza/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import Categories from'../../Categories/Categories';import PizzaBlock from'./Pizza-block';import Sort from'../../Sort/Sort';import{useEffect,useState}from'react';import SkeletonLoader from'../../../assets/SkeletonReact/SkeletonReact';import Paginate from'../../Paginate/Paginate';import{useDispatch,useSelector}from'react-redux';import{changeQueryParam,mainSelector,setPageNumber,sortSelector}from'../../../state/main-reducer';import qs from'qs';import{useNavigate}from'react-router-dom';import{useRef}from'react';import{getPizzas,pizzaItemSelector}from'../../../state/pizzas-reducer';import React from'react';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PizzaBlockContainer=function PizzaBlockContainer(){var _useSelector=useSelector(mainSelector),pizzaCategory=_useSelector.pizzaCategory,pageNumber=_useSelector.pageNumber,searchValue=_useSelector.searchValue;var _useSelector2=useSelector(sortSelector),sortNumber=_useSelector2.sortNumber,sortParam=_useSelector2.sortParam;var _useSelector3=useSelector(pizzaItemSelector),pizzasItems=_useSelector3.pizzasItems,status=_useSelector3.status;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoad=_useState2[0],setIsLoad=_useState2[1];var dispatch=useDispatch();var navigate=useNavigate();var isFetching=useRef(false);var isMounted=useRef(false);var filterFetch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var search,pagination,category,sortBy;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:search=searchValue!==''?\"name=\".concat(searchValue):'';pagination=\"page=\".concat(pageNumber,\"&limit=4\");category=pizzaCategory===0?'':\"category=\".concat(pizzaCategory);sortBy=\"sortBy=\".concat(sortParam[sortNumber]);console.log(isLoad);// Удалить в будущем\nsetIsLoad(false);//let response = await axios.get(`https://62a5c5ab430ba53411cc40f9.mockapi.io/items?${category}&${search}&${sortBy}&${pagination}`)\ndispatch(getPizzas({search:search,pagination:pagination,category:category,sortBy:sortBy}));setIsLoad(true);case 8:case\"end\":return _context.stop();}}},_callee);}));return function filterFetch(){return _ref.apply(this,arguments);};}();useEffect(function(){if(window.location.search){var param=qs.parse(window.location.search.substring(1));dispatch(changeQueryParam(param));isFetching.current=true;}},[]);useEffect(function(){if(!isFetching.current){filterFetch();};window.scrollTo(0,0);isFetching.current=false;},[isFetching,sortNumber,pizzaCategory,searchValue,pageNumber]);useEffect(function(){if(isMounted.current){var queryString=qs.stringify({pizzaCategory:pizzaCategory,pageNumber:pageNumber,sortNumber:sortNumber});navigate(\"?\".concat(queryString));}isMounted.current=true;//setSearchParams({pizzaCategory, pageNumber, sortNumber})\n},[pizzaCategory,pageNumber,sortNumber]);return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Categories,{activeCategory:pizzaCategory}),/*#__PURE__*/_jsx(Sort,{sortNumber:sortNumber})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"content__items\",children:[status==='loading'&&_toConsumableArray(new Array(6)).map(function(_,i){return/*#__PURE__*/_jsx(SkeletonLoader,{},i);}),status==='success'&&pizzasItems.map(function(obj){return/*#__PURE__*/_jsx(PizzaBlock,_objectSpread({},obj),obj.id);}),status==='error'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u041E\\u0448\\u0438\\u0431\\u043A\\u0430\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u041A \\u0441\\u043E\\u0436\\u0430\\u043B\\u0435\\u043D\\u0438\\u044E \\u043D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u043F\\u0438\\u0446\\u0446\\u044B, \\u043F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0441\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435\"})]})]}),/*#__PURE__*/_jsx(Paginate,{handlePageClick:function handlePageClick(e){return dispatch(setPageNumber(e.selected+1));}})]});};export default PizzaBlockContainer;","map":{"version":3,"names":["Categories","PizzaBlock","Sort","useEffect","useState","SkeletonLoader","Paginate","useDispatch","useSelector","changeQueryParam","mainSelector","setPageNumber","sortSelector","qs","useNavigate","useRef","getPizzas","pizzaItemSelector","React","PizzaBlockContainer","pizzaCategory","pageNumber","searchValue","sortNumber","sortParam","pizzasItems","status","isLoad","setIsLoad","dispatch","navigate","isFetching","isMounted","filterFetch","search","pagination","category","sortBy","console","log","window","location","param","parse","substring","current","scrollTo","queryString","stringify","Array","map","_","i","obj","id","e","selected"],"sources":["C:/Users/Ramon/Documents/Stydieng_the_React/React-Pizza/react-pizza/src/components/Pages/Pizza-block/PizzaBlockContainer.tsx"],"sourcesContent":["import Categories from '../../Categories/Categories';\r\nimport PizzaBlock from './Pizza-block';\r\nimport Sort from '../../Sort/Sort';\r\nimport { useEffect, useState } from 'react';\r\nimport SkeletonLoader from '../../../assets/SkeletonReact/SkeletonReact';\r\nimport Paginate from '../../Paginate/Paginate';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { changeQueryParam, mainSelector, setPageNumber, sortSelector } from '../../../state/main-reducer';\r\nimport qs from 'qs';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useRef } from 'react';\r\nimport { getPizzas, pizzaItemSelector, PizzaType } from '../../../state/pizzas-reducer';\r\nimport React from 'react';\r\nimport { AppDispatch } from '../../../state/store';\r\n\r\n export type EventTypePaginate = {\r\n  selected: number\r\n}\r\n\r\nconst PizzaBlockContainer: React.FC = () => {\r\n  const { pizzaCategory, pageNumber, searchValue } = useSelector(mainSelector);\r\n  const { sortNumber, sortParam } = useSelector(sortSelector);\r\n  const { pizzasItems, status } = useSelector(pizzaItemSelector)\r\n  const [isLoad, setIsLoad] = useState(false);\r\n  const dispatch = useDispatch<AppDispatch>();\r\n  const navigate = useNavigate();\r\n  const isFetching = useRef(false);\r\n  const isMounted = useRef(false);\r\n  \r\n  const filterFetch = async () => {\r\n    let search = searchValue !== '' ? `name=${searchValue}` : '';\r\n    let pagination = `page=${pageNumber}&limit=4`;\r\n    let category = pizzaCategory === 0 ? '' : `category=${pizzaCategory}`;\r\n    let sortBy = `sortBy=${sortParam[sortNumber]}`;\r\n    console.log(isLoad) // Удалить в будущем\r\n    setIsLoad(false)\r\n    \r\n      //let response = await axios.get(`https://62a5c5ab430ba53411cc40f9.mockapi.io/items?${category}&${search}&${sortBy}&${pagination}`)\r\n      dispatch(getPizzas({search, pagination, category, sortBy}))\r\n\r\n       setIsLoad(true);\r\n    \r\n  }\r\n\r\n  useEffect(() => {\r\n    if (window.location.search) {\r\n      let param: {pageNumber?: string, pizzaCategory?:string, sortNumber?: string} = qs.parse((window.location.search.substring(1)));\r\n      dispatch(changeQueryParam(param));\r\n      isFetching.current = true;\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (!isFetching.current) {\r\n      filterFetch();\r\n    };\r\n    window.scrollTo(0, 0);\r\n    isFetching.current = false;\r\n  }, [isFetching, sortNumber, pizzaCategory, searchValue, pageNumber]);\r\n\r\n  useEffect(() => {\r\n    if (isMounted.current) {\r\n      let queryString = qs.stringify({\r\n        pizzaCategory,\r\n        pageNumber,\r\n        sortNumber\r\n      })\r\n      navigate(`?${queryString}`);\r\n    }\r\n    isMounted.current = true;\r\n\r\n    //setSearchParams({pizzaCategory, pageNumber, sortNumber})\r\n  }, [pizzaCategory, pageNumber, sortNumber])\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"content__top\">\r\n        <Categories activeCategory={pizzaCategory} />\r\n        <Sort sortNumber={sortNumber} />\r\n      </div>\r\n      <h2 className=\"content__title\">Все пиццы</h2>\r\n      <div className=\"content__items\">\r\n        { status === 'loading' && [...new Array(6)].map((_, i) => <SkeletonLoader key={i} />) }\r\n        { status === 'success' && pizzasItems.map((obj: PizzaType) => {\r\n            return <PizzaBlock key={obj.id} {...obj} />\r\n          })\r\n        }\r\n        { status === 'error' && <div>\r\n            <h2>Произошла Ошибка</h2>\r\n            <p>К сожалению не удалось загрузить пиццы, попробуйте загрузить страницу позже</p>\r\n          </div>}\r\n      </div>\r\n      \r\n      <Paginate handlePageClick={(e:EventTypePaginate) => dispatch(setPageNumber(e.selected+ 1))} />\r\n    </div>\r\n  )\r\n};\r\n\r\nexport default PizzaBlockContainer;"],"mappings":"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"},"metadata":{},"sourceType":"module"}